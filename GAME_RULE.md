# 게임 규칙

## 🎮 게임 제목

**청기 백기 (Blue Flag White Flag)**

---

## 📝 게임 설명

전통 놀이 "청기 백기"를 포즈 인식 기술로 재해석한 게임입니다.
화면에 표시되는 명령("청기 올려", "백기 올리지 마" 등)을 보고,
제한 시간 내에 정확한 포즈를 취해야 합니다.

단계가 올라갈수록 제한 시간이 짧아지며 난이도가 증가합니다.

---

## 🎯 게임 목표

- 각 단계마다 5번의 명령을 수행
- 2번 이상 실패하지 않고 단계를 클리어하기
- 가능한 한 높은 단계까지 도달하기
- 인간 반응 속도의 한계를 시험하기

---

## 🕹️ 게임 규칙

### 기본 규칙

1. **시작**
   - "게임 시작" 버튼을 클릭하여 1단계부터 시작
   - 웹캠이 활성화되고 포즈 인식 시작

2. **명령 수행**
   - 화면에 명령이 표시됨 (예: "청기 올려", "백기 올리지 마")
   - 제한 시간 내에 올바른 포즈를 취해야 함

3. **명령 종류와 대응 포즈**

   | 명령 | 대응 포즈 | 출현 확률 |
   |-----|----------|---------|
   | "청기 올려" | 왼손 올리기 | 35% |
   | "백기 올려" | 오른손 올리기 | 35% |
   | "둘 다 올려" | 양손 올리기 | 15% |
   | "청기 올리지 마" | 기본 포즈 유지 | 5% |
   | "백기 올리지 마" | 기본 포즈 유지 | 5% |
   | "둘 다 올리지 마" | 기본 포즈 유지 | 5% |

   - **올려 명령 (85%)**: 빠른 반응 필요, 즉시 포즈 취하기
   - **올리지 마 명령 (15%)**: 함정! 기본 포즈 유지하며 시간 초과까지 대기

4. **성공/실패 판정**
   - ✅ **성공**: 제한 시간 내에 올바른 포즈 감지
   - ❌ **실패**: 제한 시간 내에 잘못된 포즈를 취하거나 올바른 포즈를 취하지 못함

5. **경고 시스템**
   - **1번 실패**: 🟡 노란 불 경고 (경고 상태)
   - **2번 실패**: 🔴 빨간 불 (단계 실패, 게임 종료)

6. **단계 클리어**
   - 5번 중 1번 이하로 실패하면 단계 성공
   - 🟢 초록 불이 켜지며 성공 축포 효과 표시
   - 자동으로 다음 단계로 진입

7. **난이도 증가**
   - 1단계: 1.0초 제한 시간
   - 2단계: 0.9초 (0.1초 감소)
   - 3단계: 0.8초 (0.1초 감소)
   - ...계속해서 0.1초씩 감소
   - 최소 제한 시간: 0.1초
   - **명령 사이 대기 시간**: 제한 시간의 절반 (동적)
     - 1단계: 0.5초 대기
     - 5단계: 0.3초 대기
     - 10단계 이상: 0.05초 대기

8. **게임 종료 및 기록**
   - 2번 실패 시 🔴 빨간 불 + 게임 오버 사운드
   - 게임 화면이 페이드아웃되며 기록 화면으로 전환
   - **기록 화면 표시 내용:**
     - 현재 게임 결과 (도달 단계, 총 성공 횟수, 게임 시간)
     - 최고 기록 (Local Storage에서 불러옴)
     - 신기록 달성 시 특수 효과 및 축하 메시지
   - 재시작 버튼 클릭 시 새 게임 시작

---

## 🎯 게임 플로우

```
시작 화면
   ↓
[게임 시작] 버튼 클릭
   ↓
웹캠 활성화 + 포즈 인식 시작
   ↓
┌──────────────────┐
│   게임 플레이     │
│  (단계별 5회)    │
└──────────────────┘
   ↓
성공 판정 → 다음 명령
   ↓
실패 판정 → 실패 카운트 증가
   ↓
┌──────────────────┐
│  실패 1회 시      │
│  🟡 노란 불 경고  │ → 게임 계속
└──────────────────┘
   ↓
┌──────────────────┐
│  실패 2회 시      │
│  🔴 빨간 불       │ → 게임 종료
│  (게임 오버)      │
└──────────────────┘
   ↓
게임 기록 화면 표시
   - 현재 게임 결과
   - 최고 기록 비교
   - [재시작] 버튼
   ↓
재시작 버튼 클릭 → 처음부터 다시 시작
```

**5회 시행 후 단계 클리어:**
```
5회 완료 (실패 1회 이하)
   ↓
🟢 초록 불 + 축포 효과
   ↓
2초 대기 (축하 애니메이션)
   ↓
다음 단계 진입 (제한 시간 -0.1초)
```

---

## 🖥️ 화면 레이아웃

### 게임 플레이 화면
```
┌─────────────────────────────────────────────────────────┐
│                     게임 정보 영역                        │
│   [단계: 1]  [진행: 3/5]  [실패: 1]  [타이머 바]         │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [청기]        [웹캠 화면]          [백기]               │
│   🚩          ┌───────────┐          🚩                │
│   ↕️          │           │          ↕️                │
│  올림/내림     │  포즈 인식  │        올림/내림            │
│              │           │                            │
│              └───────────┘                            │
│                                                         │
│                  [명령 표시]                             │
│              "청기 올려!" (큰 텍스트)                      │
│                                                         │
│              [신호등: 🟢/🟡/🔴]                          │
└─────────────────────────────────────────────────────────┘
```

**레이아웃 설명:**
- **중앙**: 웹캠 화면 (포즈 인식 시각화 포함)
- **왼쪽**: 청기 시각화
  - 왼손 올리기 감지 시: 청기 올라간 모습
  - 기본 포즈 시: 청기 내려간 모습
- **오른쪽**: 백기 시각화
  - 오른손 올리기 감지 시: 백기 올라간 모습
  - 기본 포즈 시: 백기 내려간 모습
- **상단**: 게임 정보 (단계, 진행도, 실패 횟수, 타이머)
- **하단**: 명령 표시 및 신호등

### 게임 종료 화면
```
┌─────────────────────────────────────────────────────────┐
│                    🔴 게임 종료!                         │
│                                                         │
│               ──── 게임 기록 ────                        │
│                                                         │
│           도달 단계: X 단계                              │
│           총 성공 횟수: XX회                             │
│           게임 시간: XX:XX                               │
│                                                         │
│               ──── 최고 기록 ────                        │
│                                                         │
│           최고 단계: X 단계                              │
│           최다 성공: XX회                                │
│                                                         │
│                                                         │
│              [🔄 게임 재시작]                            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**게임 종료 화면 설명:**
- 현재 게임 기록 표시 (도달 단계, 총 성공 횟수, 게임 시간)
- 최고 기록 표시 (Local Storage에서 불러옴)
- 신기록 달성 시 축하 메시지 및 특수 효과
- 재시작 버튼으로 새 게임 시작

---

## 🎨 필요한 포즈 목록

게임에 필요한 모든 포즈를 나열합니다. (Teachable Machine에서 학습할 클래스)

| 포즈 이름 | 설명 | 대응 명령 | 이모지 |
|---------|------|----------|-------|
| 기본 | 양손을 내린 자연스러운 대기 상태 | "청기/백기/둘 다 올리지 마" | 🧍 |
| 왼손 올리기 | 왼손만 위로 올린 상태 (청기) | "청기 올려" | 🙋‍♂️ (왼손) |
| 오른손 올리기 | 오른손만 위로 올린 상태 (백기) | "백기 올려" | 🙋‍♂️ (오른손) |
| 양손 올리기 | 양손 모두 위로 올린 상태 | "둘 다 올려" | 🙌 |

> **참고**: 각 포즈마다 Teachable Machine에서 최소 100개 이상의 샘플을 수집하는 것을 권장합니다.
> 특히 "기본" 포즈는 다양한 자세를 학습시켜 안정성을 높이세요.

---

## 📊 점수 및 진행도 체계

| 행동 | 결과 |
|-----|------|
| 명령 성공 | 성공 카운트 +1 |
| 첫 번째 실패 | 🟡 노란 불 경고 |
| 두 번째 실패 | 🔴 빨간 불, 게임 종료 |
| 단계 클리어 (5번 중 1번 이하 실패) | 🟢 초록 불, 축포 효과, 다음 단계 진입 |

### 통계 표시
- 현재 단계
- 현재 단계 진행도 (5번 중 몇 번째)
- 현재 단계 실패 횟수 (0/1/2)
- 총 성공 횟수
- 현재 제한 시간

---

## ⏱️ 시간 설정

### 단계별 제한 시간
- **1단계**: 1.0초
- **2단계**: 0.9초
- **3단계**: 0.8초
- **4단계**: 0.7초
- **5단계**: 0.6초
- **6단계**: 0.5초
- **7단계**: 0.4초
- **8단계**: 0.3초
- **9단계**: 0.2초
- **10단계 이상**: 0.1초

---

## 🎖️ 난이도 설정

난이도는 단계에 따라 자동으로 증가합니다.

---

## 🎵 추가 기능

### 시각적 효과
- [x] 단계별 타이머 시각화 (프로그레스 바)
- [x] 경고 시스템 (🟡 노란 불, 🔴 빨간 불)
- [x] 성공 표시 (🟢 초록 불)
- [x] 단계 클리어 축포 애니메이션
- [x] 명령 텍스트 강조 효과

### 오디오 효과
- [x] **명령 음성 출력 (TTS)**: Web Speech API 사용
  - 한국어 여성 음성 우선 선택 (유나/Yuna → Female → Google Korean)
  - "청기 올려!", "백기 올리지 마!" 등 명령 읽기
  - TTS 발화 종료 후 타이머 시작 (정확한 시간 측정)
- [x] **성공 효과음** (Web Audio API 비프음)
  - 정답 처리 시 경쾌한 상승 멜로디 (880Hz → 1320Hz)
- [x] **실패 효과음** (Web Audio API 비프음)
  - 오답 처리 시 낮은 톤 (220Hz, sawtooth)
- [x] **경고음** (Web Audio API 비프음)
  - 첫 번째 실패 시 주의 알림음 (440Hz square wave, 2회 반복)
- [x] **게임 오버 사운드** (Web Audio API 비프음)
  - 2번 실패 시 하강 멜로디 (440Hz → 392Hz → 349Hz)
- [x] **단계 클리어 사운드** (Web Audio API 비프음)
  - 축하 멜로디 (C5 → E5 → G5 → C6)

### 게임 기록
- [x] 최고 도달 단계 저장 (Local Storage)
- [x] 총 성공 횟수 기록
- [x] 게임 종료 시 기록 화면 표시
- [x] 이전 게임 기록과 비교

### UI/UX
- [x] 명령어 크게 표시
- [x] 현재 단계 표시
- [x] 진행도 표시 (5번 중 몇 번째)
- [x] 실시간 제한 시간 카운트다운
- [x] 재시작 버튼 (게임 종료 화면에 위치)
- [x] 청기/백기 시각화 (웹캠 좌우에 배치)
  - 웹캠 왼쪽: 청기 (왼손 올리기 상태에 따라 올라감/내려감)
  - 웹캠 오른쪽: 백기 (오른손 올리기 상태에 따라 올라감/내려감)

---

## 💡 게임 개발 팁

### Teachable Machine 모델 학습 시 주의사항

1. **포즈 구분을 명확하게**
   - 왼손/오른손을 확실히 구분할 수 있도록 학습
   - 양손 올리기는 완전히 양팔을 올린 상태로
   - 기본 포즈는 팔을 자연스럽게 내린 상태

2. **다양한 환경에서 샘플 수집**
   - 밝은 곳 / 어두운 곳
   - 다양한 배경
   - 여러 각도와 거리 (카메라와의 거리)
   - 다양한 옷차림 (소매 긴 옷 / 반팔)

3. **충분한 샘플 수집**
   - 각 클래스당 최소 100개 이상 권장
   - 특히 "기본" 포즈는 200개 이상 추천
   - 더 많을수록 정확도 향상

4. **전환 동작 포함**
   - 한 포즈에서 다른 포즈로 전환하는 중간 동작도 일부 포함
   - 빠른 전환 시 오인식 방지

5. **거울 효과 주의**
   - 웹캠은 좌우가 반전되므로, 자신의 왼손이 화면에서는 오른쪽에 보임
   - 명령과 포즈 매칭 시 이를 고려하여 학습

---

## 📝 개발 체크리스트

게임 개발 과정을 체크하세요.

- [x] 게임 규칙 작성 완료 ✅
- [x] Teachable Machine 포즈 모델 학습 (4개 클래스)
  - [x] 기본 포즈
  - [x] 왼손 올리기
  - [x] 오른손 올리기
  - [x] 양손 올리기
- [x] 모델 파일 `my_model/` 폴더에 배치
- [x] `js/gameEngine.js` 청기 백기 게임 로직 구현
  - [x] 명령 발급 시스템 (6가지 명령 가중치 기반 랜덤 발급)
    - "청기 올려" (35%), "백기 올려" (35%), "둘 다 올려" (15%)
    - "청기 올리지 마" (5%), "백기 올리지 마" (5%), "둘 다 올리지 마" (5%)
  - [x] 포즈 검증 로직 (명령과 포즈 매칭)
  - [x] "올리지 마" 명령 특수 처리 (시간 초과까지 위반 체크)
  - [x] 경고 시스템 (노란 불/빨간 불/초록 불)
  - [x] 단계 클리어 로직 (5회 중 1회 이하 실패)
  - [x] 난이도 증가 시스템 (1.0초 → 0.1초씩 감소 → 최소 0.1초)
  - [x] 동적 대기 시간 (제한 시간의 절반)
  - [x] 게임 종료 처리 (2번 실패 시)
  - [x] 게임 기록 관리 (Local Storage)
- [x] 오디오 시스템 구현
  - [x] TTS 음성 출력 (Web Speech API)
    - 한국어 여성 음성 우선 선택
    - Chrome/Safari 브라우저 호환
    - TTS 발화 종료 후 타이머 시작
  - [x] 효과음 추가 (Web Audio API)
    - 성공/실패/경고/게임오버/단계클리어 비프음
- [x] `js/poseEngine.js` 포즈 인식 엔진
  - [x] Teachable Machine 모델 로드
  - [x] 웹캠 스트림 처리
  - [x] 실시간 포즈 예측
- [x] `js/stabilizer.js` 예측 안정화
  - [x] 임계값 기반 필터링 (0.8)
  - [x] 스무딩 처리 (2프레임)
- [x] `index.html` UI 수정
  - [x] 게임 플레이 화면
    - [x] 명령 표시 영역 (큰 텍스트)
    - [x] 단계/진행도/실패 횟수 표시
    - [x] 경고 표시 (신호등)
    - [x] 타이머 프로그레스 바 (색상 변화)
    - [x] 청기 시각화 (웹캠 왼쪽, 올라감/내려감 애니메이션)
    - [x] 백기 시각화 (웹캠 오른쪽, 올라감/내려감 애니메이션)
    - [x] 게임 중지 버튼
  - [x] 게임 종료 화면
    - [x] 현재 게임 기록 표시
    - [x] 최고 기록 표시
    - [x] 재시작 버튼
- [x] `css/style.css` 스타일 적용
  - [x] 청기 백기 테마 디자인 (그라디언트 배경)
  - [x] 신호등 효과 (노란 불/빨간 불/초록 불)
  - [x] 축포 애니메이션
  - [x] 청기/백기 애니메이션 (올라감/내려감)
  - [x] 게임 종료 화면 스타일
  - [x] 페이드 인/아웃 전환 효과
  - [x] 반응형 디자인 (모바일 대응)
- [x] 로컬 테스트 완료
- [x] GitHub에 push (main 브랜치)
- [ ] GitHub Pages 배포

---

## 🚀 다음 단계

1. ✅ 이 파일(GAME_RULE.md) 작성 완료
2. ✅ Teachable Machine에서 4개 포즈 학습
   - 기본, 왼손 올리기, 오른손 올리기, 양손 올리기
3. ✅ 게임 로직 구현 완료
   - js/gameEngine.js: 핵심 게임 엔진
   - js/poseEngine.js: 포즈 인식 엔진
   - js/stabilizer.js: 예측 안정화
   - js/audioManager.js: 오디오 시스템
   - js/main.js: 메인 통합 로직
4. ✅ 로컬 테스트 및 디버깅 완료
5. ✅ GitHub에 push 완료 (main 브랜치)
6. 🔜 GitHub Pages로 배포 (선택사항)

---

## 🎯 게임 플레이 예시 시나리오

### 1단계 (1.0초 제한, 0.5초 대기)
1. 🔊 TTS: "청기 올려" → ⏱️ 타이머 시작 → 왼손 올림 (0.6초) ✅ 성공
2. 🔊 TTS: "백기 올리지 마" → ⏱️ 타이머 시작 → 기본 포즈 유지 (1.0초 경과) ✅ 성공
3. 🔊 TTS: "둘 다 올려" → ⏱️ 타이머 시작 → 양손 올림 (0.4초) ✅ 성공
4. 🔊 TTS: "청기 올리지 마" → ⏱️ 타이머 시작 → 실수로 왼손 올림 (0.3초) ❌ 실패 → 🟡 노란 불
5. 🔊 TTS: "백기 올려" → ⏱️ 타이머 시작 → 오른손 올림 (0.5초) ✅ 성공

**결과**: 5번 중 1번 실패 → 🟢 단계 클리어! 축포 효과! 🎉

### 2단계 (0.9초 제한, 0.45초 대기)
1. 🔊 TTS: "백기 올려" → ⏱️ 타이머 시작 → 오른손 올림 (0.5초) ✅ 성공
2. 🔊 TTS: "둘 다 올리지 마" → ⏱️ 타이머 시작 → 기본 포즈 유지 (0.9초 경과) ✅ 성공
3. 🔊 TTS: "청기 올려" → ⏱️ 타이머 시작 → 시간 초과 (0.9초) ❌ 실패 → 🟡 노란 불
4. 🔊 TTS: "둘 다 올려" → ⏱️ 타이머 시작 → 양손 올림 (0.6초) ✅ 성공
5. 🔊 TTS: "백기 올리지 마" → ⏱️ 타이머 시작 → 실수로 오른손 올림 (0.4초) ❌ 실패 → 🔴 빨간 불

**결과**: 2번 실패 → 🎵 게임 오버 사운드 → 게임 종료!

**최종 기록**: 2단계 도달, 총 8번 성공

---

## 🔧 기술 스택

### 포즈 인식
- **Teachable Machine Pose Model**: Google의 포즈 인식 모델
- **TensorFlow.js**: 브라우저에서 머신러닝 모델 실행
- **MediaPipe**: 포즈 키포인트 추출

### 오디오
- **Web Speech API**: TTS 음성 출력
  - 한국어 음성 지원
  - 브라우저 네이티브 API
- **Web Audio API**: 효과음 생성
  - Oscillator를 활용한 비프음 생성
  - Gain Node를 통한 볼륨 제어

### 게임 로직
- **바닐라 JavaScript**: 프레임워크 없이 순수 JS
- **클래스 기반 아키텍처**: 모듈화된 구조
  - GameEngine: 게임 로직
  - PoseEngine: 포즈 인식
  - AudioManager: 오디오 관리
  - PredictionStabilizer: 예측 안정화

### 저장소
- **Local Storage**: 최고 기록 저장

### UI/UX
- **CSS3 애니메이션**: 깃발, 축포, 페이드 효과
- **반응형 디자인**: 모바일/데스크톱 대응
- **그라디언트 디자인**: 청기백기 테마

---

## 📂 프로젝트 구조

```
tm-pose-bluewhite/
├── index.html              # 메인 HTML 파일
├── GAME_RULE.md           # 이 파일 (게임 규칙 및 개발 문서)
├── css/
│   └── style.css          # 게임 스타일시트
├── js/
│   ├── main.js            # 메인 진입점 (TTS, UI 통합)
│   ├── gameEngine.js      # 게임 로직 엔진
│   ├── poseEngine.js      # 포즈 인식 엔진
│   ├── stabilizer.js      # 예측 안정화 모듈
│   └── audioManager.js    # 오디오 관리 (Web Audio API)
└── my_model/              # Teachable Machine 포즈 모델
    ├── model.json         # 모델 구조
    ├── weights.bin        # 모델 가중치
    └── metadata.json      # 모델 메타데이터 (라벨 등)
```

---

## 🎮 로컬에서 실행하기

### 1. 저장소 클론
```bash
git clone https://github.com/your-username/tm-pose-bluewhite.git
cd tm-pose-bluewhite
```

### 2. 로컬 서버 실행
웹캠 권한 문제로 인해 로컬 서버가 필요합니다.

**방법 1: Python 간단 서버**
```bash
# Python 3
python -m http.server 8000

# Python 2
python -m SimpleHTTPServer 8000
```

**방법 2: VS Code Live Server**
1. VS Code에서 프로젝트 열기
2. Live Server 확장 설치
3. index.html 우클릭 → "Open with Live Server"

**방법 3: Node.js http-server**
```bash
npx http-server -p 8000
```

### 3. 브라우저에서 열기
```
http://localhost:8000
```

### 4. 웹캠 권한 허용
- 브라우저에서 웹캠 권한 요청 시 "허용" 클릭
- 게임 시작!

---

## 🌐 브라우저 호환성

| 브라우저 | TTS | Web Audio | 포즈 인식 | 전체 지원 |
|---------|-----|----------|---------|---------|
| Chrome (데스크톱) | ✅ | ✅ | ✅ | ✅ |
| Safari (데스크톱) | ✅ | ✅ | ✅ | ✅ |
| Edge | ✅ | ✅ | ✅ | ✅ |
| Firefox | ⚠️ | ✅ | ✅ | ⚠️ |
| Chrome (모바일) | ⚠️ | ✅ | ⚠️ | ⚠️ |
| Safari (모바일) | ⚠️ | ✅ | ⚠️ | ⚠️ |

- ✅ 완전 지원
- ⚠️ 부분 지원 또는 제한적 지원
- ❌ 미지원

**권장 환경**: 데스크톱 Chrome 또는 Safari

---

## 🐛 알려진 이슈 및 해결 방법

### 1. TTS 소리가 안 나올 때
- **원인**: 브라우저 autoplay 정책
- **해결**: 페이지를 새로고침하고 "게임 시작" 버튼을 다시 클릭
- **Chrome 특화**: 강력 새로고침 (Ctrl+Shift+R / Cmd+Shift+R)

### 2. 포즈 인식이 부정확할 때
- **원인**: 조명 부족, 배경 복잡함, 거리 문제
- **해결**:
  - 밝은 조명 확보
  - 단순한 배경 (벽 등)
  - 카메라와 1-2m 거리 유지
  - 전신이 프레임 안에 들어오도록 조정

### 3. 웹캠이 인식되지 않을 때
- **원인**: 웹캠 권한 거부, 다른 앱에서 사용 중
- **해결**:
  - 브라우저 설정에서 웹캠 권한 확인
  - 다른 웹캠 사용 앱 종료
  - 브라우저 재시작

### 4. 게임이 너무 빠르게 느껴질 때
- **원인**: 높은 단계에서 빠른 템포 (0.1초 제한 + 0.05초 대기)
- **팁**: TTS 음성을 듣는 동안 미리 포즈를 준비하세요!
  - "청기" 소리가 들리면 즉시 왼손 준비
  - "올려" vs "올리지 마"를 집중해서 듣기
  - 실제 반응 시간은 1.1초 이상이므로 충분히 가능합니다
- **설명**: 인간 반응 속도 한계를 시험하는 것이 게임의 목표입니다!

---

## 🤝 기여하기

이 프로젝트에 기여하고 싶으신가요?

1. 이 저장소를 Fork합니다
2. 새 브랜치를 만듭니다 (`git checkout -b feature/amazing-feature`)
3. 변경사항을 커밋합니다 (`git commit -m 'Add amazing feature'`)
4. 브랜치에 Push합니다 (`git push origin feature/amazing-feature`)
5. Pull Request를 생성합니다

---

## 📜 라이센스

이 프로젝트는 MIT 라이센스 하에 배포됩니다.

---

## 🙏 감사의 말

- **Google Teachable Machine**: 포즈 인식 모델 학습 도구
- **TensorFlow.js**: 브라우저 머신러닝 프레임워크
- **Web Speech API**: TTS 음성 출력
- **Web Audio API**: 효과음 생성

---

**즐거운 게임 되세요! 🎉**
